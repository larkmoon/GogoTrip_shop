<script th:inline="javascript">

function pricepreview(){
	
	 var qt = parseInt($('#quantity').val());	
	 var sprice = "[[${dproduct.price}]]";
		$.ajax({
			url:'getprice',
			data:{'qt':qt,
				'sprice':sprice},
			success: function(result){
				$('#pricepreview').text(result);
			}
		});
};

function addcart(pid){
	var uid = $('input[name="uid"]').val();
	var cnt = parseInt($('#quantity').val());
	$.ajax({
		url:'addcart',
		data:{'uid':uid,
			'pid':pid,
			'cnt':cnt},
		success:function(result){
			if(result == "1"){
				$('#myModal').modal();
			}else{
				location.href="/login?returnUrl="+'shop/product?id='+pid;
			}
			
		}
	});
}

$(document).ready(function(){
	
	var qtt = parseInt($('#quantity').val());
	var sprice = "[[${dproduct.price}]]";
	var stock = "[[${dproduct.stock}]]";
	
	
	$('#pricepreview').text(qtt * sprice);
	
	   $('.quantity-right-plus').click(function(e){
	        
	        // Stop acting like a button
	        e.preventDefault();
	        // Get the field name
	        var quantity = parseInt($('#quantity').val());	        
	        // If is not undefined	            
	           
	        if(quantity == stock){
	        	alert('상품의 재고 수량은 ' + stock + '개입니다.');
	        }else{
	        	// Increment	   
	        	 $('#quantity').val(quantity + 1);
	        }		    
				   pricepreview();
	    });

	     $('.quantity-left-minus').click(function(e){
	        // Stop acting like a button
	        e.preventDefault();
	        // Get the field name
	        var quantity = parseInt($('#quantity').val());	        
	        // If is not undefined	      
	            // Increment
	            if(quantity == 1){
	            	alert('상품의 최소 주문 수량은 1개입니다.');
	            	 $('#quantity').val(1);	           
	            }else{
	            	 $('#quantity').val(quantity - 1);
	            }
	            pricepreview();
	    });
	     
     $('#btn_gocart').click(function(){
    	 var uid = $('#uid').val();
    	 location.href='cart?id='+uid;
     });
     
     $('#btn_buynow').click(function(){
    	 var uid = $('#uid').val();
    	 $('#buynow_cnt').val($('input[name="quantity"]').val());
    	 $('#buynow_uid').val(uid);
    	 
    	 $('#form_buynow').attr({
    		 'method':'post',
    		 'action':'order?uid='+uid
    	 });
    	 $('#form_buynow').submit();
    	 
    	 // location.href='order?id='+uid;
     });
	    
});
</script>

<section class="ftco-section">
	<div class="container">
		<div class="row">
			<div class="col-lg-6 mb-5 ftco-animate">
				<a th:if="${dproduct.imgname != null}" th:href="'/images/'+${dproduct.imgname}" class="image-popup">
					<img th:if="${dproduct.imgname != null}" th:src="'/images/'+${dproduct.imgname}"  class="img-fluid" alt="Colorlib Template">
				</a>
				<a th:unless="${dproduct.imgname != null}" th:href="'/images/gogologo'" class="image-popup">
					<img th:unless="${dproduct.imgname != null}" th:src="'/images/gogologo'"  class="img-fluid" alt="Colorlib Template">
				</a>
			</div>
			<div class="col-lg-6 product-details pl-md-5 ftco-animate">
				<h3 th:text="${dproduct.name}"></h3>
				<p class="price"><span th:text="${dproduct.price}+'원'"></span></p>
				<p th:if="${dproduct.description != null}" th:text="${dproduct.description}">
				</p>
				<div class="row mt-4">
					<div class="w-100"></div>
					<div class="input-group col-md-6 d-flex mb-3">
			          	<span class="input-group-btn mr-2">
			             	<button type="button" class="quantity-left-minus btn"  data-type="minus" data-field="">
			              		  <i class="ion-ios-remove"></i>
			             	</button>
			         	</span>
			          	<input type="text" id="quantity" name="quantity"
			          	class="form-control input-number" value="1" min="1" max="100"
			          	onkeypress="if(event.keyCode=='13'){event.preventDefault(); pricepreview();}">
			          	<span class="input-group-btn ml-2">
			             	<button type="button" class="quantity-right-plus btn" data-type="plus" data-field="">
			                  	<i class="ion-ios-add"></i>
			             	 </button>
			          	</span>
		       		</div>
			       	<div class="w-100"></div>
			       	<div class="col-md-12">
			       		<p style="color: #000;" th:text="'남은 수량: '+${dproduct.stock}+'개'"></p>
			       	</div>
			       	<div class="col-md-12">
			       		<span style="color: #000;">총 상품 금액: </span>
			       		<span style="color: #000;" id="pricepreview"></span>
			       		<span style="color: #000;">원</span>
			       	</div>
			       	<!-- uid 숨김 -->
			       	<input type="hidden" th:if="${session.logincust != null}" th:value="${session.logincust.id}" name="uid" id="uid">
		      	</div>
			<!-- 장바구니에 담기 / 주문 / 품절 버튼 -->
		      	<p><a href="#" id="btn_addcart" th:if="${dproduct.stock > 0}" th:onclick="addcart([[${dproduct.id}]])" class="btn btn-black py-3 px-5">Add to Cart</a></p>
		      	<p><a href="#" id="btn_buynow"  th:if="${dproduct.stock > 0}" class="btn btn-black py-3 px-5">Buy Now</a></p>
		      	<p><a id="btn_buynow"  th:if="${dproduct.stock == 0}" class="btn btn-black py-3 px-5">Sold out</a></p>
			</div>
		</div>
	</div>
</section>

<!-- Buy Now Form Start -->
	<form id="form_buynow">
		<input type="hidden" name="orders[0].pid" th:value="${dproduct.id}">
		<input type="hidden" name="orders[0].cnt" id="buynow_cnt">
		<input type="hidden" name="orders[0].uid" th:id="buynow_uid" th:if="${session.logincust != null}" th:value="${session.logincust.id}">
	</form>
<!-- Buy Now Form End -->


<!-- The Modal -->
<div class="modal" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h6 class="modal-title">상품이 장바구니에 등록되었습니다.</h4>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">계속 쇼핑하기</button>
        <button type="button" id="btn_gocart" class="btn btn-danger" data-dismiss="modal">주문하러 가기</button>
      </div>

    </div>
  </div>
</div>

